box:
  id: golang
  ports: 3000
dev:
  steps:
    - internal/watch:
       code: |
        go build ./...
        ./source
       reload: true
build:
  box: golang
  steps:
    # lint 
    - wercker/golint
    - setup-go-workspace:
        package-dir: github.com/moos3/checkIp
    - script:
        name: install go tools
        code: |
          go get -u github.com/tomasen/realip
          go get -u github.com/kardianos/govendor
          go get -u -v github.com/golang/dep
          go get -u -v github.com/golang/dep/cmd/dep
    - script:
        name: install dependencies
        code: |
          dep ensure
    # test
    - script:
      name: go test
      code: |
        go test ./...
    - script:
      name: go build
      code: CGO_ENABLED=0 go build -a -ldflags '-s' -installsuffix cgo -o app ./...
    - script:
      name: copy binary
      code: cp app "$WERCKER_OUTPUT_DIR"
deploy:
    box: golang
    steps:
     # Use the scratch step to build a container from scratch based on the files present
    - internal/docker-scratch-push:
      username: $QUAY_USERNAME
      password: $QUAY_PASSWORD
      cmd: ./app
      tag: $WERCKER_GIT_COMMIT
      ports: "3000"
      resposity: quay.io/moos3/checkip
      registry: https://quay.io